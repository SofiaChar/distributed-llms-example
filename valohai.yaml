- step:
    name: train-torchrun
    image: sofiiavalohai/valohai-llms:v1.5
    environment: staging-aws-eu-west-1-p3-8xlarge
    command:
      - pip install valohai-utils
      - torchrun --nproc-per-node=4 train-torchrun.py {parameters}
    parameters:
      - name: dataset-name
        default: "samsum"
      - name: model-ckpt
        default: "facebook/bart-large-cnn"
      - name: output-dir
        default: "bart-large-cnn"
      - name: batch-size
        default: 1
      - name: num-epochs
        default: 1
      - name: warmup-steps
        default: 500
      - name: evaluation-steps
        default: 500

- step:
    name: train-accelerator
    image: sofiiavalohai/valohai-llms:v1.5
    environment: staging-aws-eu-west-1-p3-8xlarge
    command:
      - pip install accelerate evaluate absl-py rouge-score
      - python -m accelerate.commands.launch --num_processes=4 train-accelerator.py
